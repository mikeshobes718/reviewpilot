option_settings:
  aws:elasticbeanstalk:application:environment:
    NODE_ENV: production
    NPM_USE_PRODUCTION: false
  aws:elasticbeanstalk:environment:proxy:staticfiles:
    /static: /static
    /_next: /_next
    /favicon.ico: /favicon.ico
  aws:elasticbeanstalk:environment:proxy:
    ProxyServer: nginx
  aws:autoscaling:launchconfiguration:
    InstanceType: t3.small
  aws:ec2:instances:
    InstanceTypes: t3.small
    EnableSpot: false

container_commands:
  01_install_dependencies:
    command: |
      npm ci --include=dev
    cwd: /var/app/staging
  02_build_application:
    command: |
      npm run build
    cwd: /var/app/staging
  03_cleanup_dev_deps:
    command: |
      npm prune --omit=dev
    cwd: /var/app/staging
